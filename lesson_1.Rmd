---
title: "Lesson 1"
author: "Giuliano Colosimo, PhD"
date: 2022-04-08
output: 
  html_document:
    toc: true
    toc_float: true
    toc_depth: 4
    df_print: paged # default, kable, tibble, paged
bibliography: /Users/giulianocolosimo/Dropbox/manuscripts/literature/bibtex/comprehensive_database.bib
csl: /Users/giulianocolosimo/Dropbox/manuscripts/literature/bibtex/biomedcentral.csl
citation_package: biblatex
citecolor: "red"
link-citations: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
x <- c("plotrix",
       "raster",
       "sf", "spData", "spDataLarge")

lapply(x, require, character.only = T)
rm(x)
```

In this first lesson we will:

1. cover the basics of Animal Tracking;
2. set up your computers to be used during the class (and hopefully in your future research);
3. get you acquainted with the most commonly used spatial data objects and their features;
4. get an overview of some CRSs;
5. exercise assignment.

# Animal Tracking

Animal Tracking is a discipline that allows to gather information about the biology, ecology, behavior and life history of animals starting from data on their position in the natural environment. There are two major requirements for this discipline to be successful:

1. the capability to uniquely identify individuals, populations or species;
2. the availability of position data for that individual (population or species) and a geographic reference system that help minimizing errors when calculating parameters of interest (distance traveled, area covered, etc. etc.).

The first requirement is fundamental. How can we say anything about a certain individual, population or species if we are not able to identify it (them)? [@Costa2015]. The second point is also important as it allows to pinpoint the exact location of the studied organism and, through the use of statistical methods, to relate observations with environmental variables and to perform predictions about the distribution and persistence of individuals [@Guisan2000]. 

## Tagging systems

People have been tagging animals (wild and captive) for hundreds of years. A tag is a label that is attached to "something" and provides general information about that something it is attached to! 

An animal tag can be as simple as a piece of metal or plastic with a number carved on it or with a standardized meaning (Figure 1), or a more complex electronic device that not only identifies an individual, but also provides useful information about that animal (Figure 2). Small devices transmitting specific radio frequencies have been, and still are, widely used to track animals. This technology is simple and effective, although it has limitation when it comes to study duration and ease at accessing the data (Figures 3 and 4). Eventually, the data can be organized in to produce really informative (and cool) animations, like the one you can see in Figure 5.

![**Figure 1:** A male *Cyclura carinata* with colored bead tags. In this case, each color corresponds to a number and it is therefore possible to identify this individual without catching it. This particular individual is 131 (white, blue, white). Photo credits: Giuliano Colosimo.](./figures/1_1_iguana_beads.png)

![**Figure 2:** A male *Conolophus marthae* with a Wireless Sensor Node (WSN) attached behind its hindlegs. This is a more sofisticated electronic tag that not only allows to identify the individual but also allows to collect important information such as GPS data, temperature and UV light. Photo credits: Giuliano Colosimo.](./figures/1_2_iguana_wsn.png)

![**Figure 3:** Barrell transmitter implanted in a female TCI Rainbow Boa (*Chilabothrus chrysogaster*) for a telemetry study. Photo credits: Giuliano Colosimo.](./figures/1_3_boa_transmitter.png)

![**Figure 4:** Using a radio antenna to pinpoint the location of tagged boas. Photo credits: Giuliano Colosimo.](./figures/1_4_reynolds_antenna.png)

![**Figure 5** Migration patterns of cranes (*Grus grus*) from Sweden. The data was downloaded from [www.movebank.org](www.movebank.org). We will be using this website as resource throughout the course and we will be using different routines in **R** to analyze the data.](./animations/1_5_cranes.gif)

For the longest time data were collected by hand and/or transcribed onto an electronic sheet. In animal tracking, and more generally in every discipline involving the use of georeferenced data, computers have become increasingly important. That is why setting up your computers is going to be fundamental if you are interested in working in this discipline and if you want to pass this class :-) 

# Setting up your computer

To visualize and analyse data and to produce reports on all the activities of this course we will be using **R** and **RStudio**. These are free cross-platform software. 

- Visit the [R](https://cran.r-project.org) page and download the version of the R-software compatible to your OS. Install the software following the instructions.

- Visit the [RStudio](https://www.rstudio.com/products/rstudio/download/) page and download the RStudio Desktop version compatible with your OS. Install the software following the instructions.

**NOTE**: **RStudio** is an Integrated Development Environment (IDE) within which it should be easier to organize your **R** workflow. Learning all the specifics of **R** and **RStudio** is beyond the scope of this course and it is a student's responsibility to learn the basics of these tools. That being said, *you can always write me with your questions if something does not work on your computer* and I will help troubleshooting potential issues.

Once software have been installed, open **RStudio**. If everything worked appropriately when you first open **RStudio**, you should see 4 different panes organized in the following way:

- *top left*: the editor where you edit scripts, documents and can run code directly in the console;
- *bottom left*: the R console, where the code is run. You can type code directly into the console OR you can send it to the console by running it from the editor;
- *top right*: your environment/history panes. This is where you can see variables youâ€™ve created and a full history of functions / commands you have run;
- *bottom right*: by default contains several panes including: files/plots/packages/help/viewer. The files pane allows you to explore files on your computer like you would in windows explorer or finder on a mac. The plots tab is where you will see plots that you create.
    
In Figure 6 panes have been re-arranged according to my personal likes. Feel free to do the same with your **RStudio** using the *Preferences*.

![**Figure 6:** Screen shot of what you should see at the end of the installation of all the software. Note that colors and panes' arrangement is likely going to be different on your computer. You can change many of the aspects parameters in **RStudio** and you can arrange colors and panes in the way that works best for you.](./figures/1_6_r_rstudio.png)

Learning how to use **R** is beyond the scope of this course. Suffice to say that there are thousands of available libraries (aka, *packages*) that can be used to perform many different calculations. As we proceed we will be installing all the libraries we need and if you find some library that may be of interest we will find the time to review and see how it can be used. 

![**Figure 7:** This graph shows how the interest in spatial analysis increased in the last ten years. The package **sf** [@Pebesma2018] has received a lot of attention and it has become one of the new standard on how to use and treat certain types of spatial data. ](./figures/1_7_package_downloads.png)

# The basics of spatial data

The main characteristic of a spatial object is that it has coordinates attached to it. Having coordinates means that we have a way to index that object on a map. We will touch on Coordinate Reference Systems (CRS) here, but first we will focus on the most common and widely used types of spatial data.  

## Vector

**NOTE:** the world vector is used in **R** to also indicate a specific type of data format, and it is easy to get be confused. Make sure to understand what a vector is when we talk about it in a spatial context!

We recognize three main types of vectors:

1. Points
2. Lines
3. Polygons

### Points

- Points, generally used for single site locations (cities, field observations, buildings)

```{r points_1, echo = FALSE, fig.cap = "**Figure 8:** An example of three points on a map. The table below has some additional information on what those points are."}
plot(1, xlim = c(0,30), ylim = c(0,30), 
     # xaxt = 'n', yaxt = 'n',
     xlab = "Longitude", ylab = "Latitude",
     type = "n")
rect(par("usr")[1], par("usr")[3],
     par("usr")[2], par("usr")[4],
     col = "honeydew")
par(new = TRUE)
grid()
points(x = c(2, 12, 25), y = c(8, 28, 15),
       pch = 21, 
       bg = c("red", "darkgreen", "blue"))
text(x = c(2, 12, 25) + .8, y = c(8, 28, 15)+ .8, 
     labels = c(1, 2, 3),
     col = c("red", "darkgreen", "blue"))
```

```{r points_2, echo = FALSE}
(data.frame("Point_ID" = c("1", "2", "3"),
           "Type" = c("Vegetation", "Vegetation", "Vegetation"),
           "Characteristics" = c("Shrubs", "Grass", "Forest")))
```

### Lines

- Lines, generally used for rivers or streets.

```{r lines_1, echo = FALSE, fig.cap = "**Figure 9:** Two lines representing a road and a river , respectively. Information about the lines is presented in the table below the figure."}
plot(1, xlim = c(0,30), ylim = c(0,30), 
     #xaxt = 'n', yaxt = 'n',
     xlab = "Longitude", ylab = "Latitude",
     type = "n")
rect(par("usr")[1], par("usr")[3],
     par("usr")[2], par("usr")[4],
     col = "honeydew")
par(new = TRUE)
grid()
lines(x = c(2, 12), y = c(8, 28))
lines(x = seq(1, 30, 0.01), y = cos(seq(1, 30, 0.01)) + 5)
points(x = c(2, 12, 1, 30), 
       y = c(8, 28, cos(1) + 5 , cos(30) + 5), 
       pch = 21, bg = "deeppink")
text(x = c(2, 12, 1, 30) + c(-.8, .8, 0, 0),
     y = c(8, 28, 4, 4) + c(0, 0, 0, 0), 
     labels = c(1, 2, 3, 4))
text(x = c(6.3, 15),
     y = c(19, 3), 
     labels = c("A", "B"), font = 2)
```

```{r lines_2, echo = FALSE}
(data.frame("Line_ID" = c("A", "B"),
           "Type" = c("Road", "River"),
           "Length" = c("15 km", "20 km"),
           "Features" = c("straight", "bends")))

```

### Polygons

- Polygons, generally used to specify home-ranges or areas of particular interest. 

```{r polygons, echo = FALSE, fig.cap = "**Figure 10:** A polygon representing a patch of forest. information about this polygon is presented in the table right below the figure."}
plot(1, xlim = c(0,30), ylim = c(0,30), 
     #xaxt = 'n', yaxt = 'n',
     xlab = "Longitude", ylab = "Latitude",
     type = "n")
rect(par("usr")[1], par("usr")[3],
     par("usr")[2], par("usr")[4],
     col = "honeydew")
par(new = TRUE)
grid()
polygon(x = c(2, 12, 25), y = c(8, 28, 15), 
        col = "grey")
points(x = c(2, 12, 25), 
       y = c(8, 28, 15), 
       pch = 21, bg = "deeppink")
text(x = c(2, 12, 25) + c(-.9, .9, .9),
     y = c(8, 28, 15) + c(-.5, .5, .5), 
     labels = c(1, 2, 3))
text(x = 15,
     y = 10, 
     labels = "A", font = 2)
```

```{r polygons_2, echo = FALSE}
(data.frame("Polygon_ID" = "A",
           "Type" = "Forest",
           "Area" = "25 hectares",
           "Features" = "private land"))
```

Vector data are widely used. The table below shows all drivers available based on the installation of [GDAL](https://gdal.org/index.html) (GDAL is a translator library for raster and vector geospatial data formats).

```{r sf_drivers, echo = FALSE}
sf::st_drivers()
```

Recently vector data have been represented using a specific class of data type known as *Simple Feature*. 

*Simple Feature* is an open standard developed and endorsed by the [Open Geospatial Consortium (OGC)](https://www.ogc.org). The official definition from their documentation is the following: *The simple feature geometry object model is Distributed Computing Platform neutral and uses UML (Unified Modeling Language) notation. The base Geometry class has subclasses for Point, Curve, Surface and GeometryCollection. Each geometric object is associated with a Spatial Reference System, which describes the coordinate space in which the geometric object is defined*.

In **R** *Simple Features* are handled by the **sf** package [@Pebesma2018]. This is the successor of the **sp** [@Pebesma2005] package based on the OGC standard Simple Features. As its successor, **sf** combines the functionality of **sp** with those of two other packages for the analysis of geospatial data: **rgeos** [@Bivand2021] and **rgdal** [@Bivand2021b]. The **sf**  package handles additional vector data types (e.g. polygon and multipolygon are two separate classes), allows for easier data processing, and supports spatial databases such as PostGIS. The official web-page for this package with various additional information is available [here](https://r-spatial.github.io/sf/).

What does an object of class sf look like?

```{r sf_load_data_lib, eval=FALSE, message=TRUE, include=T}
library(spData)
```

```{r sf_type_1, eval=FALSE, message=TRUE, include=T}
world

Simple feature collection with 177 features and 10 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
```

```{r sf_type_2, echo=FALSE, message=TRUE}
world
```

## Raster

A different type of spatial data is called raster. Raster data differ from vector data as they are not associated to sets of latitudinal and longitudinal values, but they rather encompass a geographic area and divide that area in cells of user-defined size (i.e, a raster's resolution). To each cell is then assigned a valued dependent on the characteristic of interest. Raster can be used to represent continuous and/or categorical variables.

```{r raster_1, eval=T, echo = F, include=T, fig.cap = "**Figure 11:** Elevation (continuous variable) raster of Wolf Volcano, Isabela Island, GalÃ¡pagos."}
load("~/Dropbox/iguanas/conolophus/wsn_data_analysis/nesting_beahavior/pink_range.RData")
Wolf_elevation <- crop(Wolf_elevation, extent(pink_range)+.15)

plot(Wolf_elevation, main = "Continuous variable \nElevation",
     xaxt = 'n', yaxt = 'n',
     xlab = "Longitude", ylab = "Latitude")
```


```{r raster_2, eval=T, echo = F, include=T, fig.cap = "**Figure 12:** Land use (categorical variable) on a a patch of land (these data have been randomly generated)."}
r_categorical <-  raster(matrix(sample(1:10, 900, replace = TRUE), 30, 30))

plot(r_categorical, col = hcl.colors(10, "Set 2"), main = "Categorical variable \nLand Use",
     xaxt = 'n', yaxt = 'n',
     xlab = "Longitude", ylab = "Latitude", legend = F)
par(xpd = T)
legend("topright", 
       inset = c(-0.25, 0.12),
       legend = c("Urban", "Agriculture", "Forest", "Prot. Areas", "Devel.",
                  "Nat Park", "Desert", "Land Fill", "Unknown", "Pasture"),
       pch = 22, pt.bg = hcl.colors(10, "Set 2"),
      ncol = 1, bty = "n")
```


## CRS

# Litterature to read

The first paper to read for the next time we meet (i.e., 2022-04-15) was written by Cagnacci and colleagues in 2010 [@Cagnacci2010]. 

# Reference

